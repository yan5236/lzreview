# LzReview - é™æ€ç½‘ç«™è¯„è®ºç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Cloudflare Workers å’Œ D1 æ•°æ®åº“çš„è½»é‡çº§é™æ€ç½‘ç«™è¯„è®ºç³»ç»Ÿã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ åŸºäº Cloudflare Workersï¼Œå…¨çƒè¾¹ç¼˜è®¡ç®—ï¼Œå“åº”å¿«é€Ÿ
- ğŸ’¾ ä½¿ç”¨ D1 æ•°æ®åº“ï¼Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨
- ğŸ¨ å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- ğŸ”’ å†…ç½®å®‰å…¨é˜²æŠ¤ï¼ˆXSSã€CSRFã€é€Ÿç‡é™åˆ¶ã€ç™½åå•ï¼‰
- ğŸ‘¤ æ”¯æŒ QQ å¤´åƒå’Œè‡ªåŠ¨ç”Ÿæˆå¤´åƒ
- ğŸ’¬ æ”¯æŒå›å¤åŠŸèƒ½
- ğŸ”§ ç®¡ç†åå°ï¼ˆç™½åå•ç®¡ç†ã€è¯„è®ºç®¡ç†ï¼‰
- ğŸ“± æ˜“äºé›†æˆï¼Œåªéœ€å‡ è¡Œä»£ç 
- ğŸ›  æ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. éƒ¨ç½²å‡†å¤‡

1. ç¡®ä¿ä½ æœ‰ Cloudflare è´¦å·
2. å®‰è£… Wrangler CLIï¼š
   ```bash
   npm install -g wrangler
   ```

### 2. é…ç½®é¡¹ç›®

1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®åˆ°æœ¬åœ°
2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   npm install
   ```

3. åˆ›å»º D1 æ•°æ®åº“ï¼š
   ```bash
   wrangler d1 create lzreview-db
   ```

4. å¤åˆ¶é…ç½®æ–‡ä»¶ï¼š
   ```bash
   cp wrangler.toml.example wrangler.toml
   ```
   
   æ›´æ–° `wrangler.toml` ä¸­çš„é…ç½®ï¼š
   - å°† `your-database-id-here` æ›¿æ¢ä¸ºä¸Šä¸€æ­¥åˆ›å»ºçš„æ•°æ®åº“ID
   - ç”Ÿæˆå¼ºéšæœºä»¤ç‰Œæ›¿æ¢ `your-admin-token-here`

5. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š
   ```bash
   npm run db:migrate
   ```

### 3. éƒ¨ç½²åˆ° Cloudflare Workers

```bash
npm run deploy
```

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç±»ä¼¼ `https://lzreview.your-subdomain.workers.dev` çš„URLã€‚

### 4. åœ¨ç½‘ç«™ä¸­é›†æˆè¯„è®º

åœ¨ä½ çš„ç½‘é¡µä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```html
<!-- è¯„è®ºå®¹å™¨ -->
<div id="lzreview-comments"></div>

<!-- å¼•å…¥è¯„è®ºç³»ç»Ÿ -->
<script>
window.lzreviewConfig = {
    apiUrl: 'https://your-worker-url.workers.dev',
    pageUrl: window.location.href,
    placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§...'
};
</script>
<script src="https://your-worker-url.workers.dev/embed.js"></script>
```

## âš™ï¸ é…ç½®é€‰é¡¹

é€šè¿‡ `window.lzreviewConfig` å¯¹è±¡å¯ä»¥è‡ªå®šä¹‰è¯„è®ºç³»ç»Ÿï¼š

```javascript
window.lzreviewConfig = {
    apiUrl: 'https://your-worker-url.workers.dev',  // å¿…å¡«ï¼šWorker URL
    pageUrl: window.location.href,                  // å¿…å¡«ï¼šå½“å‰é¡µé¢URL
    placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§...',                    // å¯é€‰ï¼šè¯„è®ºæ¡†å ä½ç¬¦
    maxLength: 1000,                                 // å¯é€‰ï¼šè¯„è®ºæœ€å¤§é•¿åº¦
    requireName: true,                               // å¯é€‰ï¼šæ˜¯å¦å¿…é¡»å¡«å†™å§“å
    requireEmail: false                              // å¯é€‰ï¼šæ˜¯å¦å¿…é¡»å¡«å†™é‚®ç®±
};
```

## ğŸ›  ç®¡ç†åŠŸèƒ½

### åˆ é™¤è¯„è®º

ä½¿ç”¨ç®¡ç†å‘˜ä»¤ç‰Œå¯ä»¥åˆ é™¤è¯„è®ºï¼š

```bash
curl -X DELETE "https://your-worker-url.workers.dev/api/comments/123" \\
     -H "Authorization: Bearer your-admin-token"
```

### è®¾ç½®ç®¡ç†å‘˜ä»¤ç‰Œ

åœ¨ `wrangler.toml` ä¸­è®¾ç½®ï¼š

```toml
[vars]
ADMIN_TOKEN = "your-secret-admin-token"
```

æˆ–åœ¨ Cloudflare Workers æ§åˆ¶å°çš„ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ã€‚

## ğŸ“Š API æ¥å£

### è·å–è¯„è®º

```
GET /api/comments?page={pageUrl}&limit={limit}&offset={offset}
```

### å‘å¸ƒè¯„è®º

```
POST /api/comments
Content-Type: application/json

{
  "pageUrl": "https://example.com/post1",
  "authorName": "ç”¨æˆ·å",
  "authorEmail": "user@example.com",
  "content": "è¯„è®ºå†…å®¹"
}
```

### åˆ é™¤è¯„è®ºï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

```
DELETE /api/comments/{id}
Authorization: Bearer {admin-token}
```

## ğŸ”§ å¼€å‘

### æœ¬åœ°å¼€å‘

```bash
npm run dev
```

è¿™ä¼šå¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ã€‚

### é¡¹ç›®ç»“æ„

```
lzreview/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # Worker ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ handlers/             # è¯·æ±‚å¤„ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ comments.js       # è¯„è®ºAPIå¤„ç†
â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ schema.sql        # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â””â”€â”€ db.js             # æ•°æ®åº“æ“ä½œå°è£…
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ validation.js     # æ•°æ®éªŒè¯
â”‚   â”‚   â”œâ”€â”€ security.js       # å®‰å…¨ç›¸å…³
â”‚   â”‚   â””â”€â”€ response.js       # å“åº”æ ¼å¼åŒ–
â”‚   â””â”€â”€ web/                  # å‰ç«¯èµ„æº
â”‚       â”œâ”€â”€ embed.js          # åµŒå…¥å¼è¯„è®ºç»„ä»¶
â”‚       â””â”€â”€ embed.css         # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ wrangler.toml             # Cloudflare Workersé…ç½®
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **é€Ÿç‡é™åˆ¶**ï¼šé˜²æ­¢åˆ·æ–°æ”»å‡»
- **å†…å®¹è¿‡æ»¤**ï¼šæ£€æµ‹å¹¶é˜»æ­¢ä¸å½“å†…å®¹
- **è¾“å…¥å‡€åŒ–**ï¼šé˜²æ­¢XSSæ”»å‡»
- **CORSæ”¯æŒ**ï¼šå®‰å…¨çš„è·¨åŸŸè¯·æ±‚
- **ç®¡ç†å‘˜æƒé™**ï¼šåˆ é™¤åŠŸèƒ½éœ€è¦ä»¤ç‰ŒéªŒè¯

## ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ æ”¯æŒ

å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹ Cloudflare Workers æ§åˆ¶å°çš„æ—¥å¿—
2. æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°é”™è¯¯  
3. ç¡®è®¤æ•°æ®åº“è¿æ¥å’Œé…ç½®æ­£ç¡®

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **XSS é˜²æŠ¤**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡ä¸¥æ ¼è¿‡æ»¤å’Œè½¬ä¹‰
- **CSRF é˜²æŠ¤**ï¼šä½¿ç”¨ä»¤ç‰ŒéªŒè¯é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ 
- **é€Ÿç‡é™åˆ¶**ï¼šé˜²æ­¢åƒåœ¾è¯„è®ºå’Œæš´åŠ›æ”»å‡»
- **ç™½åå•æœºåˆ¶**ï¼šåªå…è®¸æˆæƒåŸŸåä½¿ç”¨è¯„è®ºåŠŸèƒ½
- **å†…å®¹è¿‡æ»¤**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œè¿‡æ»¤ä¸å½“å†…å®¹
- **IP éšç§ä¿æŠ¤**ï¼šå­˜å‚¨å“ˆå¸Œå€¼è€Œéæ˜æ–‡ IP åœ°å€

## ğŸ”§ ç®¡ç†åå°

è®¿é—® `https://your-worker.your-subdomain.workers.dev/admin` è¿›å…¥ç®¡ç†åå°ï¼Œå¯ä»¥ï¼š

- ç®¡ç†ç™½åå•åŸŸå
- æŸ¥çœ‹å’Œåˆ é™¤è¯„è®º
- æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯

## ğŸ¯ è·¯çº¿å›¾

- [x] å›å¤åŠŸèƒ½
- [x] å®‰å…¨é˜²æŠ¤ï¼ˆXSSã€CSRFã€é€Ÿç‡é™åˆ¶ï¼‰
- [x] ç™½åå•ç®¡ç†
- [x] QQå¤´åƒæ”¯æŒ
- [ ] é‚®ä»¶é€šçŸ¥
- [ ] æ›´å¤šä¸»é¢˜æ ·å¼
- [ ] ç»Ÿè®¡åˆ†æé¢æ¿
- [ ] è¯„è®ºå®¡æ ¸åŠŸèƒ½
